library(testthat)

test.time.series.operators = function() {

  #------------------------------------------------------------------------------
  # Tests ported from t0/src/python/t0/tests/test_time_series.py

  #------------------------------------------------------------------------------
  # EMA

  expect_equal(
    ema(tau=2, t=c(1, 3, 4, 6, 7, 10, 12, 13, 15, 17), z=c(1, 4, 3, 10, 8, 9, 7, 6, 4, 7)),
    c(1, 2.8963616765, 2.9371401793, 7.4017190761, 7.6371242765, 8.6959013216, 7.6238872305, 6.9849373932, 5.0980971001, 6.300329024)
  )

  #------------------------------------------------------------------------------
  # EMA

  expect_equal(
    iema(tau=20, n=6, t=c(1, 3, 4, 6, 7, 10, 12, 13, 15, 17), z=c(1, 4, 3, 10, 8, 9, 7, 6, 4, 7)),
    c(1, 1.00000222, 1.00000429, 1.00002761, 1.00004609, 1.00040788, 1.00086683, 1.00115674, 1.00217357, 1.00378598)
  )

  #------------------------------------------------------------------------------
  # MA

  expect_equal(
    ma(tau=200, n=4, t=c(1, 3, 4, 6, 7, 10, 12, 13, 15, 17), z=c(1, 4, 3, 10, 8, 9, 7, 6, 4, 7)),
    c(1, 1.0189863333377565, 1.0252755524368804, 1.0822345063554102, 1.1042467425841644, 1.1806698780437825, 1.2186414719853111, 1.234363838189307, 1.2533478171556403, 1.2913167901623905)
  )

  #------------------------------------------------------------------------------
  # EMS

  expect_equal(
    ems(tau=2, t=c(1, 3, 4, 6, 7, 10, 12, 13, 15, 17), z=c(1, 4, 3, 10, 8, 9, 7, 6, 4, 7)),
    c(1, 4.3678794412, 5.649252799, 12.0782439627, 15.3258252789, 12.4196538489, 11.5689353175, 13.0169139703, 8.7886550372, 10.2331655037)
  )
}

test.time.series.operators()
